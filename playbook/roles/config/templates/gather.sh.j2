#!/bin/sh

set -e

# ansible.builtin.template
PRIVATE_IP={{ (ansible_facts.env['SSH_CONNECTION'] | split)[2] }}
PUBLIC_IP={{ ansible_facts.all_ipv4_addresses | difference([(ansible_facts.env['SSH_CONNECTION'] | split)[2]]) | first | default("") }}

facts_dir=/etc/ansible/facts.d
cat <<EOF >$facts_dir/config.fact
{
  "private_ip": "$PRIVATE_IP",
  "public_ip": "$PUBLIC_IP"
}
EOF
